{% extends "base.html" %}
{% block content %}

<style>
body {
    background:#f7f1ea;
    font-family:"Poppins",sans-serif;
}

.dashboard-container {
    max-width:1200px;
    margin:40px auto;
    padding:20px;
}

.title {
    text-align:center;
    font-size:35px;
    font-weight:800;
    color:#4b3022;
    margin-bottom:30px;
}

.tab-buttons {
    display:flex;
    justify-content:center;
    gap:20px;
    margin-bottom:25px;
}

.tab-btn {
    background:#9e4f33;
    padding:12px 20px;
    border:none;
    color:white;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
    font-weight:600;
}

.tab-btn.active,
.tab-btn:hover {
    background:#7c3a23;
}

.tab-section {
    display:none;
    background:white;
    padding:25px;
    border-radius:12px;
    box-shadow:0px 6px 20px rgba(0,0,0,0.1);
}

.tab-section.active {
    display:block;
}

.table-box {
    margin-top:15px;
    overflow:hidden;
    border-radius:12px;
}

table {
    width:100%;
    border-collapse:collapse;
}

thead {
    background:#f2d1b3;
}

th, td {
    padding:12px;
    border-bottom:1px solid #e8d9cc;
}

.product-img {
    width:70px;
    border-radius:6px;
}

.update-btn {
    padding:6px 12px;
    border:none;
    color:white;
    border-radius:4px;
    cursor:pointer;
}

.price-update { background:#f0a500; }
.stock-update { background:#28a745; }

.delete-btn {
    background:#d9534f;
    color:white;
    padding:6px 12px;
    border-radius:6px;
    text-decoration:none;
}
</style>

<div class="dashboard-container">
    <h2 class="title">üßµ Admin Dashboard</h2>

    <!-- TABS -->
    <div class="tab-buttons">
        <button class="tab-btn active" onclick="openTab('products', this)">üõç Products</button>
        <button class="tab-btn" onclick="openTab('enquiries', this)">üì© Enquiries</button>
        <button class="tab-btn" onclick="openTab('orders', this)">üí∏ Orders</button>
    </div>

    <!-- PRODUCTS -->
    <div id="products" class="tab-section active">
        <h3>Products</h3>

        {% if products %}
        <div class="table-box">
            <table>
                <thead>
                    <tr>
                        <th>ID</th><th>Image</th><th>Name</th>
                        <th>Price</th><th>Stock</th><th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in products %}
                    <tr>
                        <td>{{ p.id }}</td>
                        <td>
                            {% if p.image %}
                            <img src="{{ url_for('static', filename='uploads/' + p.image) }}" class="product-img">
                            {% endif %}
                        </td>
                        <td>{{ p.name }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('update_price', product_id=p.id) }}">
                                <input type="number" name="price" value="{{ p.price }}">
                                <button class="update-btn price-update">Update</button>
                            </form>
                        </td>
                        <td>
                            <form method="POST" action="{{ url_for('update_quantity', product_id=p.id) }}">
                                <input type="number" name="quantity" value="{{ p.quantity }}">
                                <button class="update-btn stock-update">Update</button>
                            </form>
                        </td>
                        <td>
                            <a class="delete-btn" href="{{ url_for('delete_product', id=p.id) }}">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No products found.</p>
        {% endif %}
    </div>

    <!-- ENQUIRIES -->
    <div id="enquiries" class="tab-section">
        <h3>Customer Enquiries</h3>

        {% if enquiries %}
        <div class="table-box">
            <table>
                <thead>
                    <tr><th>ID</th><th>Name</th><th>Email</th><th>Message</th></tr>
                </thead>
                <tbody>
                    {% for e in enquiries %}
                    <tr>
                        <td>{{ e.id }}</td>
                        <td>{{ e.name }}</td>
                        <td>{{ e.email }}</td>
                        <td>{{ e.message }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No enquiries yet.</p>
        {% endif %}
    </div>

    <!-- ORDERS -->
    <div id="orders" class="tab-section">
        <h3>Customer Orders</h3>

        {% if orders %}
        <div class="table-box">
            <table>
                <thead>
                    <tr>
                        <th>ID</th><th>Customer</th><th>Address</th>
                        <th>Contact</th><th>Product</th>
                        <th>Message</th><th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for o in orders %}
                    <tr>
                        <td>{{ o.id }}</td>
                        <td>{{ o.customer_name }}</td>
                        <td>{{ o.address }}</td>
                        <td>{{ o.contact }}</td>
                        <td>{{ o.product_name }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('admin_send_order_message') }}">
                                <input type="hidden" name="user_id" value="{{ o.user_id }}">
                                <input type="hidden" name="order_id" value="{{ o.id }}">
                                <textarea name="message" required></textarea>
                                <button class="update-btn stock-update">Send</button>
                            </form>
                        </td>
                        <td>
                            <a class="delete-btn"
                               href="{{ url_for('delete_order', order_id=o.id) }}"
                               onclick="return confirm('Delete this order?');">
                               Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p>No orders yet.</p>
        {% endif %}
    </div>
</div>

<script>
function openTab(tabName, btn) {
    document.querySelectorAll(".tab-section").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(tabName).classList.add("active");
    btn.classList.add("active");
}
</script>

{% endblock %}
